<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>MdeModulePkg[all]: MdeModulePkg/Include/Library/CapsuleLib.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MdeModulePkg[all]
   &#160;<span id="projectnumber">0.98</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_capsule_lib_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">CapsuleLib.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab44a3b5c597b9cc48c07753acb8d5c4c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_capsule_lib_8h.html#ab44a3b5c597b9cc48c07753acb8d5c4c">COD_RELOCATION_INFO_VAR_NAME</a>&#160;&#160;&#160;L&quot;CodRelocationInfo&quot;</td></tr>
<tr class="separator:ab44a3b5c597b9cc48c07753acb8d5c4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aefe073701a5a1207f22ae95397243641"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_capsule_lib_8h.html#aefe073701a5a1207f22ae95397243641">SupportCapsuleImage</a> (IN EFI_CAPSULE_HEADER *CapsuleHeader)</td></tr>
<tr class="separator:aefe073701a5a1207f22ae95397243641"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23a4e0a45e0b84c1aeeb230ae729368b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_capsule_lib_8h.html#a23a4e0a45e0b84c1aeeb230ae729368b">ProcessCapsuleImage</a> (IN EFI_CAPSULE_HEADER *CapsuleHeader)</td></tr>
<tr class="separator:a23a4e0a45e0b84c1aeeb230ae729368b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff9442a6e154abd7e6f270902b5e419a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_capsule_lib_8h.html#aff9442a6e154abd7e6f270902b5e419a">ProcessCapsules</a> (<a class="el" href="_display_protocol_8h.html#ae9c54c060568c862c771ad80bb63bf48">VOID</a>)</td></tr>
<tr class="separator:aff9442a6e154abd7e6f270902b5e419a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51937572bb08870431125b2d78f11a76"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_form_browser_ex2_8h.html#a314372a42b06efd845536fb2058e3345">BOOLEAN</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_capsule_lib_8h.html#a51937572bb08870431125b2d78f11a76">CoDCheckCapsuleOnDiskFlag</a> (<a class="el" href="_display_protocol_8h.html#ae9c54c060568c862c771ad80bb63bf48">VOID</a>)</td></tr>
<tr class="separator:a51937572bb08870431125b2d78f11a76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2e43f3d078b0138c1c25d478a981bb4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_capsule_lib_8h.html#ae2e43f3d078b0138c1c25d478a981bb4">CoDClearCapsuleOnDiskFlag</a> (<a class="el" href="_display_protocol_8h.html#ae9c54c060568c862c771ad80bb63bf48">VOID</a>)</td></tr>
<tr class="separator:ae2e43f3d078b0138c1c25d478a981bb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc644b437a2e9a1361cdb50f00130d11"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_capsule_lib_8h.html#adc644b437a2e9a1361cdb50f00130d11">CoDRelocateCapsule</a> (<a class="el" href="_display_protocol_8h.html#a2181335bcdc6b2c3b39d1fc778d77a2e">UINTN</a> MaxRetry)</td></tr>
<tr class="separator:adc644b437a2e9a1361cdb50f00130d11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16fb0fe2cc620046679f0fe9b4b76d3f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_capsule_lib_8h.html#a16fb0fe2cc620046679f0fe9b4b76d3f">CoDRemoveTempFile</a> (<a class="el" href="_display_protocol_8h.html#a2181335bcdc6b2c3b39d1fc778d77a2e">UINTN</a> MaxRetry)</td></tr>
<tr class="separator:a16fb0fe2cc620046679f0fe9b4b76d3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This library class defines a set of interfaces for how to process capsule image updates.</p>
<p>Copyright (c) 2007 - 2019, Intel Corporation. All rights reserved.<br/>
 SPDX-License-Identifier: BSD-2-Clause-Patent </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ab44a3b5c597b9cc48c07753acb8d5c4c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COD_RELOCATION_INFO_VAR_NAME&#160;&#160;&#160;L&quot;CodRelocationInfo&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a51937572bb08870431125b2d78f11a76"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_form_browser_ex2_8h.html#a314372a42b06efd845536fb2058e3345">BOOLEAN</a> EFIAPI CoDCheckCapsuleOnDiskFlag </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_display_protocol_8h.html#ae9c54c060568c862c771ad80bb63bf48">VOID</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This routine is called to check if CapsuleOnDisk flag in OsIndications Variable is enabled.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">TRUE</td><td>Flag is enabled </td></tr>
    <tr><td class="paramname">FALSE</td><td>Flag is not enabled </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae2e43f3d078b0138c1c25d478a981bb4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI CoDClearCapsuleOnDiskFlag </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_display_protocol_8h.html#ae9c54c060568c862c771ad80bb63bf48">VOID</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This routine is called to clear CapsuleOnDisk flags including OsIndications and BootNext variable.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>All Capsule On Disk flags are cleared </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="adc644b437a2e9a1361cdb50f00130d11"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI CoDRelocateCapsule </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_display_protocol_8h.html#a2181335bcdc6b2c3b39d1fc778d77a2e">UINTN</a>&#160;</td>
          <td class="paramname"><em>MaxRetry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Relocate Capsule on Disk from EFI system partition.</p>
<p>Two solution to deliver Capsule On Disk: Solution A: If PcdCapsuleInRamSupport is enabled, relocate Capsule On Disk to memory and call UpdateCapsule(). Solution B: If PcdCapsuleInRamSupport is disabled, relocate Capsule On Disk to a platform-specific NV storage device with BlockIo protocol.</p>
<p>Device enumeration like USB costs time, user can input MaxRetry to tell function to retry. Function will stall 100ms between each retry.</p>
<p>Side Effects: Capsule Delivery Supported Flag in OsIndication variable and BootNext variable will be cleared. Solution B: Content corruption. Block IO write directly touches low level write. Orignal partitions, file systems of the relocation device will be corrupted.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">MaxRetry</td><td>Max Connection Retry. Stall 100ms between each connection try to ensure devices like USB can get enumerated. Input 0 means no retry.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>Capsule on Disk images are successfully relocated. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a16fb0fe2cc620046679f0fe9b4b76d3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI CoDRemoveTempFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_display_protocol_8h.html#a2181335bcdc6b2c3b39d1fc778d77a2e">UINTN</a>&#160;</td>
          <td class="paramname"><em>MaxRetry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove the temp file from the root of EFI System Partition. Device enumeration like USB costs time, user can input MaxRetry to tell function to retry. Function will stall 100ms between each retry.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">MaxRetry</td><td>Max Connection Retry. Stall 100ms between each connection try to ensure devices like USB can get enumerated. Input 0 means no retry.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>Remove the temp file successfully. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a23a4e0a45e0b84c1aeeb230ae729368b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI ProcessCapsuleImage </td>
          <td>(</td>
          <td class="paramtype">IN EFI_CAPSULE_HEADER *&#160;</td>
          <td class="paramname"><em>CapsuleHeader</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The firmware-specific implementation processes the capsule image if it recognized the format of this capsule image.</p>
<p>Caution: This function may receive untrusted input.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">CapsuleHeader</td><td>Pointer to the UEFI capsule image to be processed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCESS</td><td>Capsule Image processed successfully. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>Capsule image is not supported by the firmware. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aff9442a6e154abd7e6f270902b5e419a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI ProcessCapsules </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_display_protocol_8h.html#ae9c54c060568c862c771ad80bb63bf48">VOID</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This routine is called to process capsules.</p>
<p>Caution: This function may receive untrusted input.</p>
<p>The capsules reported in EFI_HOB_UEFI_CAPSULE are processed. If there is no EFI_HOB_UEFI_CAPSULE, this routine does nothing.</p>
<p>This routine should be called twice in BDS. 1) The first call must be before EndOfDxe. The system capsules is processed. If device capsule FMP protocols are exposted at this time and device FMP capsule has zero EmbeddedDriverCount, the device capsules are processed. Each individual capsule result is recorded in capsule record variable. System may reset in this function, if reset is required by capsule and all capsules are processed. If not all capsules are processed, reset will be defered to second call.</p>
<p>2) The second call must be after EndOfDxe and after ConnectAll, so that all device capsule FMP protocols are exposed. The system capsules are skipped. If the device capsules are NOT processed in first call, they are processed here. Each individual capsule result is recorded in capsule record variable. System may reset in this function, if reset is required by capsule processed in first call and second call.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>There is no error when processing capsules. </td></tr>
    <tr><td class="paramname">EFI_OUT_OF_RESOURCES</td><td>No enough resource to process capsules. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aefe073701a5a1207f22ae95397243641"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_platform_boot_manager_8h.html#aaed96bd0619ee6b8526d64337e745391">EFI_STATUS</a> EFIAPI SupportCapsuleImage </td>
          <td>(</td>
          <td class="paramtype">IN EFI_CAPSULE_HEADER *&#160;</td>
          <td class="paramname"><em>CapsuleHeader</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The firmware checks whether the capsule image is supported by the CapsuleGuid in CapsuleHeader or if there is other specific information in the capsule image.</p>
<p>Caution: This function may receive untrusted input.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">CapsuleHeader</td><td>Pointer to the UEFI capsule image to be checked.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCESS</td><td>Input capsule is supported by firmware. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>Input capsule is not supported by the firmware. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_54cb27adfbe3c9131eabcdf8b02d1207.html">MdeModulePkg</a></li><li class="navelem"><a class="el" href="dir_18ec75d2ad33879c083782e393e99453.html">Include</a></li><li class="navelem"><a class="el" href="dir_c84d4490a6a57540c54360a283dbe1bf.html">Library</a></li><li class="navelem"><a class="el" href="_capsule_lib_8h.html">CapsuleLib.h</a></li>
    <li class="footer">Generated on Sun Dec 5 2021 03:40:30 for MdeModulePkg[all] by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
