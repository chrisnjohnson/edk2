<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>OvmfPkg[all]: OvmfPkg/Include/Library/QemuFwCfgS3Lib.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OvmfPkg[all]
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_qemu_fw_cfg_s3_lib_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">QemuFwCfgS3Lib.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a83439ddd2f8c1b6267b9c4bf51d92943"><td class="memItemLeft" align="right" valign="top">typedef IN OUT <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a83439ddd2f8c1b6267b9c4bf51d92943">ScratchBuffer</a></td></tr>
<tr class="separator:a83439ddd2f8c1b6267b9c4bf51d92943"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a23864acba126cda7b73c60d678b0d3b4"><td class="memItemLeft" align="right" valign="top">BOOLEAN EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a23864acba126cda7b73c60d678b0d3b4">QemuFwCfgS3Enabled</a> (<a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a>)</td></tr>
<tr class="separator:a23864acba126cda7b73c60d678b0d3b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02ffa82fc26da9679a8ec91dfbdcb199"><td class="memItemLeft" align="right" valign="top">typedef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a02ffa82fc26da9679a8ec91dfbdcb199">VOID</a> (EFIAPI FW_CFG_BOOT_SCRIPT_CALLBACK_FUNCTION)(IN OUT VOID *Context</td></tr>
<tr class="separator:a02ffa82fc26da9679a8ec91dfbdcb199"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7926410882674e9b87a7bd0caaa4b5cb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_pci_cap_lib_8h.html#a5fce4c365fd2bc5169738ad9abc59cea">RETURN_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady</a> (IN FW_CFG_BOOT_SCRIPT_CALLBACK_FUNCTION *Callback, IN OUT <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> *Context, IN UINTN ScratchBufferSize)</td></tr>
<tr class="separator:a7926410882674e9b87a7bd0caaa4b5cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d7364af97dda541e1e9d84258fff898"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_pci_cap_lib_8h.html#a5fce4c365fd2bc5169738ad9abc59cea">RETURN_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a6d7364af97dda541e1e9d84258fff898">QemuFwCfgS3ScriptWriteBytes</a> (IN INT32 FirmwareConfigItem, IN UINTN <a class="el" href="_virtio_device_8h.html#a03b101dd0e307d46720705ec087cb0c0">NumberOfBytes</a>)</td></tr>
<tr class="separator:a6d7364af97dda541e1e9d84258fff898"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ac9ca470868fa5661c3c218b86426a0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_pci_cap_lib_8h.html#a5fce4c365fd2bc5169738ad9abc59cea">RETURN_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a6ac9ca470868fa5661c3c218b86426a0">QemuFwCfgS3ScriptReadBytes</a> (IN INT32 FirmwareConfigItem, IN UINTN <a class="el" href="_virtio_device_8h.html#a03b101dd0e307d46720705ec087cb0c0">NumberOfBytes</a>)</td></tr>
<tr class="separator:a6ac9ca470868fa5661c3c218b86426a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af99f7b5b6abbfab8878103199cdad872"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_pci_cap_lib_8h.html#a5fce4c365fd2bc5169738ad9abc59cea">RETURN_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#af99f7b5b6abbfab8878103199cdad872">QemuFwCfgS3ScriptSkipBytes</a> (IN INT32 FirmwareConfigItem, IN UINTN <a class="el" href="_virtio_device_8h.html#a03b101dd0e307d46720705ec087cb0c0">NumberOfBytes</a>)</td></tr>
<tr class="separator:af99f7b5b6abbfab8878103199cdad872"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af52d09acd4df1f8a805e1c4b0926f09e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_pci_cap_lib_8h.html#a5fce4c365fd2bc5169738ad9abc59cea">RETURN_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#af52d09acd4df1f8a805e1c4b0926f09e">QemuFwCfgS3ScriptCheckValue</a> (IN <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> *ScratchData, IN UINT8 ValueSize, IN UINT64 ValueMask, IN UINT64 <a class="el" href="_virtio_device_8h.html#ab6fbbcd0f26087b3614e24064a140cf8">Value</a>)</td></tr>
<tr class="separator:af52d09acd4df1f8a805e1c4b0926f09e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>S3 support for QEMU fw_cfg</p>
<p>This library class enables driver modules (a) to query whether S3 support was enabled on the QEMU command line, (b) to produce fw_cfg DMA operations that are to be replayed at S3 resume time.</p>
<p>Copyright (C) 2017, Red Hat, Inc.</p>
<p>SPDX-License-Identifier: BSD-2-Clause-Patent </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a83439ddd2f8c1b6267b9c4bf51d92943"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef IN OUT <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a>* <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a83439ddd2f8c1b6267b9c4bf51d92943">ScratchBuffer</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a7926410882674e9b87a7bd0caaa4b5cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_pci_cap_lib_8h.html#a5fce4c365fd2bc5169738ad9abc59cea">RETURN_STATUS</a> EFIAPI QemuFwCfgS3CallWhenBootScriptReady </td>
          <td>(</td>
          <td class="paramtype">IN FW_CFG_BOOT_SCRIPT_CALLBACK_FUNCTION *&#160;</td>
          <td class="paramname"><em>Callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN OUT <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> *&#160;</td>
          <td class="paramname"><em>Context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINTN&#160;</td>
          <td class="paramname"><em>ScratchBufferSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Install the client module's FW_CFG_BOOT_SCRIPT_CALLBACK_FUNCTION callback for when the production of ACPI S3 Boot Script opcodes becomes possible.</p>
<p>Take ownership of the client-provided Context, and pass it to the callback function, when the latter is invoked.</p>
<p>Allocate scratch space for those ACPI S3 Boot Script opcodes to work upon that the client will produce in the callback function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Callback</td><td>FW_CFG_BOOT_SCRIPT_CALLBACK_FUNCTION to invoke when the production of ACPI S3 Boot Script opcodes becomes possible. Callback() may be called immediately from <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a>.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">Context</td><td>Client-provided data structure for the Callback() callback function to consume.</td></tr>
  </table>
  </dd>
</dl>
<p>If Context points to dynamically allocated memory, then Callback() must release it.</p>
<p>If Context points to dynamically allocated memory, and <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a> returns successfully, then the caller of <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a> must neither dereference nor even evaluate Context any longer, as ownership of the referenced area has been transferred to Callback().</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ScratchBufferSize</td><td>The size of the scratch buffer that will hold, in reserved memory, all client data read, written, and checked by the ACPI S3 Boot Script opcodes produced by Callback().</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RETURN_UNSUPPORTED</td><td>The library instance does not support this function.</td></tr>
    <tr><td class="paramname">RETURN_NOT_FOUND</td><td>The fw_cfg DMA interface to QEMU is unavailable.</td></tr>
    <tr><td class="paramname">RETURN_BAD_BUFFER_SIZE</td><td>ScratchBufferSize is too large.</td></tr>
    <tr><td class="paramname">RETURN_OUT_OF_RESOURCES</td><td>Memory allocation failed.</td></tr>
    <tr><td class="paramname">RETURN_SUCCESS</td><td>Callback() has been installed, and the ownership of Context has been transferred. Reserved memory has been allocated for the scratch buffer.</td></tr>
  </table>
  </dd>
</dl>
<p>A successful invocation of <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a> cannot be rolled back.</p>
<dl class="section return"><dt>Returns</dt><dd>Error codes from underlying functions. </dd></dl>

</div>
</div>
<a class="anchor" id="a23864acba126cda7b73c60d678b0d3b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOLEAN EFIAPI QemuFwCfgS3Enabled </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Determine if S3 support is explicitly enabled.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">TRUE</td><td>If S3 support is explicitly enabled. Other functions in this library may be called (subject to their individual restrictions).</td></tr>
  </table>
  </dd>
</dl>
<p>FALSE Otherwise. This includes unavailability of the firmware configuration interface. No other function in this library must be called. </p>

</div>
</div>
<a class="anchor" id="af52d09acd4df1f8a805e1c4b0926f09e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_pci_cap_lib_8h.html#a5fce4c365fd2bc5169738ad9abc59cea">RETURN_STATUS</a> EFIAPI QemuFwCfgS3ScriptCheckValue </td>
          <td>(</td>
          <td class="paramtype">IN <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> *&#160;</td>
          <td class="paramname"><em>ScratchData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINT8&#160;</td>
          <td class="paramname"><em>ValueSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINT64&#160;</td>
          <td class="paramname"><em>ValueMask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINT64&#160;</td>
          <td class="paramname"><em>Value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Produce ACPI S3 Boot Script opcodes that check a value in ScratchBuffer.</p>
<p>If the check fails during S3 resume, the boot script will hang.</p>
<p>This function may only be called from the client module's FW_CFG_BOOT_SCRIPT_CALLBACK_FUNCTION, which was passed to <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a> as Callback.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ScratchData</td><td>Pointer to the UINT8, UINT16, UINT32 or UINT64 field in ScratchBuffer that should be checked. The caller is responsible for populating the field during S3 resume, by calling <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a6ac9ca470868fa5661c3c218b86426a0">QemuFwCfgS3ScriptReadBytes()</a> ahead of <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#af52d09acd4df1f8a805e1c4b0926f09e">QemuFwCfgS3ScriptCheckValue()</a>.</td></tr>
  </table>
  </dd>
</dl>
<p>ScratchData must point into ScratchBuffer, which was allocated, and passed to Callback(), by <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a>.</p>
<p>ScratchData must be aligned at ValueSize bytes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ValueSize</td><td>One of 1, 2, 4 or 8, specifying the size of the field to check.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ValueMask</td><td>The value read from ScratchData is binarily AND-ed with ValueMask, and the result is compared against Value. If the masked data equals Value, the check passes, and the boot script can proceed. Otherwise, the check fails, and the boot script hangs.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Value</td><td>Refer to ValueMask.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RETURN_SUCCESS</td><td>The opcodes were appended to the ACPI S3 Boot Script successfully. There is no way to undo this action.</td></tr>
    <tr><td class="paramname">RETURN_INVALID_PARAMETER</td><td>ValueSize is invalid.</td></tr>
    <tr><td class="paramname">RETURN_INVALID_PARAMETER</td><td>ValueMask or Value cannot be represented in ValueSize bytes.</td></tr>
    <tr><td class="paramname">RETURN_INVALID_PARAMETER</td><td>ScratchData is not aligned at ValueSize bytes.</td></tr>
    <tr><td class="paramname">RETURN_BAD_BUFFER_SIZE</td><td>The ValueSize bytes at ScratchData aren't wholly contained in the ScratchBufferSize bytes at ScratchBuffer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error codes from underlying functions. </dd></dl>

</div>
</div>
<a class="anchor" id="a6ac9ca470868fa5661c3c218b86426a0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_pci_cap_lib_8h.html#a5fce4c365fd2bc5169738ad9abc59cea">RETURN_STATUS</a> EFIAPI QemuFwCfgS3ScriptReadBytes </td>
          <td>(</td>
          <td class="paramtype">IN INT32&#160;</td>
          <td class="paramname"><em>FirmwareConfigItem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINTN&#160;</td>
          <td class="paramname"><em>NumberOfBytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Produce ACPI S3 Boot Script opcodes that (optionally) select an fw_cfg item, and transfer data from it.</p>
<p>The opcodes produced by <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a6ac9ca470868fa5661c3c218b86426a0">QemuFwCfgS3ScriptReadBytes()</a> will read NumberOfBytes bytes from fw_cfg using DMA, storing the result in ScratchBuffer, in reserved memory.</p>
<p>If the operation fails during S3 resume, the boot script will hang.</p>
<p>This function may only be called from the client module's FW_CFG_BOOT_SCRIPT_CALLBACK_FUNCTION, which was passed to <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a> as Callback.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">FirmwareConfigItem</td><td>The UINT16 selector key of the firmware config item to read, expressed as INT32. If FirmwareConfigItem is -1, no selection is made, the read will occur from the currently selected item, from its currently selected offset. Otherwise, the specified item will be selected, and the read will occur from offset 0.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">NumberOfBytes</td><td>Size of the data to read during S3 resume. NumberOfBytes must not exceed ScratchBufferSize, which was passed to <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RETURN_SUCCESS</td><td>The opcodes were appended to the ACPI S3 Boot Script successfully. There is no way to undo this action.</td></tr>
    <tr><td class="paramname">RETURN_INVALID_PARAMETER</td><td>FirmwareConfigItem is invalid.</td></tr>
    <tr><td class="paramname">RETURN_BAD_BUFFER_SIZE</td><td>NumberOfBytes is larger than ScratchBufferSize.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error codes from underlying functions. </dd></dl>

</div>
</div>
<a class="anchor" id="af99f7b5b6abbfab8878103199cdad872"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_pci_cap_lib_8h.html#a5fce4c365fd2bc5169738ad9abc59cea">RETURN_STATUS</a> EFIAPI QemuFwCfgS3ScriptSkipBytes </td>
          <td>(</td>
          <td class="paramtype">IN INT32&#160;</td>
          <td class="paramname"><em>FirmwareConfigItem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINTN&#160;</td>
          <td class="paramname"><em>NumberOfBytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Produce ACPI S3 Boot Script opcodes that (optionally) select an fw_cfg item, and increase its offset.</p>
<p>If the operation fails during S3 resume, the boot script will hang.</p>
<p>This function may only be called from the client module's FW_CFG_BOOT_SCRIPT_CALLBACK_FUNCTION, which was passed to <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a> as Callback.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">FirmwareConfigItem</td><td>The UINT16 selector key of the firmware config item to advance the offset of, expressed as INT32. If FirmwareConfigItem is -1, no selection is made, and the offset for the currently selected item is increased. Otherwise, the specified item will be selected, and the offset increment will occur from offset 0.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">NumberOfBytes</td><td>The number of bytes to skip in the subject fw_cfg item.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RETURN_SUCCESS</td><td>The opcodes were appended to the ACPI S3 Boot Script successfully. There is no way to undo this action.</td></tr>
    <tr><td class="paramname">RETURN_INVALID_PARAMETER</td><td>FirmwareConfigItem is invalid.</td></tr>
    <tr><td class="paramname">RETURN_BAD_BUFFER_SIZE</td><td>NumberOfBytes is too large.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error codes from underlying functions. </dd></dl>

</div>
</div>
<a class="anchor" id="a6d7364af97dda541e1e9d84258fff898"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_pci_cap_lib_8h.html#a5fce4c365fd2bc5169738ad9abc59cea">RETURN_STATUS</a> EFIAPI QemuFwCfgS3ScriptWriteBytes </td>
          <td>(</td>
          <td class="paramtype">IN INT32&#160;</td>
          <td class="paramname"><em>FirmwareConfigItem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINTN&#160;</td>
          <td class="paramname"><em>NumberOfBytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Produce ACPI S3 Boot Script opcodes that (optionally) select an fw_cfg item, and transfer data to it.</p>
<p>The opcodes produced by <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a6d7364af97dda541e1e9d84258fff898">QemuFwCfgS3ScriptWriteBytes()</a> will first restore NumberOfBytes bytes in ScratchBuffer in-place, in reserved memory, then write them to fw_cfg using DMA.</p>
<p>If the operation fails during S3 resume, the boot script will hang.</p>
<p>This function may only be called from the client module's FW_CFG_BOOT_SCRIPT_CALLBACK_FUNCTION, which was passed to <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a> as Callback.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">FirmwareConfigItem</td><td>The UINT16 selector key of the firmware config item to write, expressed as INT32. If FirmwareConfigItem is -1, no selection is made, the write will occur to the currently selected item, at its currently selected offset. Otherwise, the specified item will be selected, and the write will occur at offset 0.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">NumberOfBytes</td><td>Size of the data to restore in ScratchBuffer, and to write from ScratchBuffer, during S3 resume. NumberOfBytes must not exceed ScratchBufferSize, which was passed to <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RETURN_SUCCESS</td><td>The opcodes were appended to the ACPI S3 Boot Script successfully. There is no way to undo this action.</td></tr>
    <tr><td class="paramname">RETURN_INVALID_PARAMETER</td><td>FirmwareConfigItem is invalid.</td></tr>
    <tr><td class="paramname">RETURN_BAD_BUFFER_SIZE</td><td>NumberOfBytes is larger than ScratchBufferSize.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error codes from underlying functions. </dd></dl>

</div>
</div>
<a class="anchor" id="a02ffa82fc26da9679a8ec91dfbdcb199"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef VOID </td>
          <td>(</td>
          <td class="paramtype">EFIAPI&#160;</td>
          <td class="paramname"><em>FW_CFG_BOOT_SCRIPT_CALLBACK_FUNCTION</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prototype for the callback function that the client module provides.</p>
<p>In the callback function, the client module calls the <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a6d7364af97dda541e1e9d84258fff898">QemuFwCfgS3ScriptWriteBytes()</a>, <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a6ac9ca470868fa5661c3c218b86426a0">QemuFwCfgS3ScriptReadBytes()</a>, <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#af99f7b5b6abbfab8878103199cdad872">QemuFwCfgS3ScriptSkipBytes()</a>, and <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#af52d09acd4df1f8a805e1c4b0926f09e">QemuFwCfgS3ScriptCheckValue()</a> functions. Those functions produce ACPI S3 Boot Script opcodes that will perform fw_cfg DMA operations, and will check any desired values that were read, during S3 resume.</p>
<p>The callback function is invoked when the production of ACPI S3 Boot Script opcodes becomes possible. This may occur directly on the call stack of <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a> (see below), or after <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a> has successfully returned.</p>
<p>The callback function must not return if it fails &ndash; in the general case, there is noone to propagate any errors to. Therefore, on error, an error message should be logged, and CpuDeadLoop() must be called.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">Context</td><td>Carries information from the client module itself (i.e., from the invocation of <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a>) to the callback function.</td></tr>
  </table>
  </dd>
</dl>
<p>If Context points to dynamically allocated storage, then the callback function must release it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ScratchBuffer</td><td>Points to reserved memory, allocated by <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a> internally.</td></tr>
  </table>
  </dd>
</dl>
<p>ScratchBuffer is typed and sized by the client module when it calls <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a7926410882674e9b87a7bd0caaa4b5cb">QemuFwCfgS3CallWhenBootScriptReady()</a>. The client module defines a union type of structures for ScratchBuffer such that the union can hold client data for any desired fw_cfg DMA read and write operations, and value checking.</p>
<p>The callback function casts ScratchBuffer to the union type described above. It passes union member sizes as NumberOfBytes to <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a6ac9ca470868fa5661c3c218b86426a0">QemuFwCfgS3ScriptReadBytes()</a> and <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#a6d7364af97dda541e1e9d84258fff898">QemuFwCfgS3ScriptWriteBytes()</a>. It passes field addresses and sizes in structures in the union as ScratchData and ValueSize to <a class="el" href="_qemu_fw_cfg_s3_lib_8h.html#af52d09acd4df1f8a805e1c4b0926f09e">QemuFwCfgS3ScriptCheckValue()</a>.</p>
<p>ScratchBuffer is aligned at 8 bytes. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_782809600008140d37245a8991744230.html">OvmfPkg</a></li><li class="navelem"><a class="el" href="dir_65f9f3e48d1acd3a56b2b8a29723b724.html">Include</a></li><li class="navelem"><a class="el" href="dir_92a52f437583bf372b183e16e2da6eca.html">Library</a></li><li class="navelem"><a class="el" href="_qemu_fw_cfg_s3_lib_8h.html">QemuFwCfgS3Lib.h</a></li>
    <li class="footer">Generated on Sun Dec 5 2021 00:44:20 for OvmfPkg[all] by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
