<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>OvmfPkg[all]: OvmfPkg/Include/Library/VirtioLib.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OvmfPkg[all]
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_virtio_lib_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">VirtioLib.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_d_e_s_c___i_n_d_i_c_e_s.html">DESC_INDICES</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa2085097636d56c69b494e6e888fe296"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_virtio_device_8h.html#a74d7020e18780b17f5f8ca0573b29482">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_virtio_lib_8h.html#aa2085097636d56c69b494e6e888fe296">VirtioRingInit</a> (IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *VirtIo, IN UINT16 <a class="el" href="_virtio_device_8h.html#ab65154637eaaf40f80aafbff39931bb1">QueueSize</a>, OUT <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *<a class="el" href="_virtio_device_8h.html#a2f00e71da7561b92d4924692680bd38c">Ring</a>)</td></tr>
<tr class="separator:aa2085097636d56c69b494e6e888fe296"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d4116c6aaf08c320bee0b3cfb1b63ed"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_virtio_device_8h.html#a74d7020e18780b17f5f8ca0573b29482">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_virtio_lib_8h.html#a9d4116c6aaf08c320bee0b3cfb1b63ed">VirtioRingMap</a> (IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *VirtIo, IN <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *<a class="el" href="_virtio_device_8h.html#a2f00e71da7561b92d4924692680bd38c">Ring</a>, OUT UINT64 *<a class="el" href="_virtio_device_8h.html#a4576ce15790aff63b8880dc9f2badcdd">RingBaseShift</a>, OUT <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> **<a class="el" href="_virtio_device_8h.html#a286147d373e39bf0562dc60dbfbba621">Mapping</a>)</td></tr>
<tr class="separator:a9d4116c6aaf08c320bee0b3cfb1b63ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4a083ec4bee2616db38ffcb04251d14"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_virtio_lib_8h.html#ae4a083ec4bee2616db38ffcb04251d14">VirtioRingUninit</a> (IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *VirtIo, IN OUT <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *<a class="el" href="_virtio_device_8h.html#a2f00e71da7561b92d4924692680bd38c">Ring</a>)</td></tr>
<tr class="separator:ae4a083ec4bee2616db38ffcb04251d14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1456d91b0095ef7f57b57ca869b0ca1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_virtio_lib_8h.html#aa1456d91b0095ef7f57b57ca869b0ca1">VirtioPrepare</a> (IN OUT <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *<a class="el" href="_virtio_device_8h.html#a2f00e71da7561b92d4924692680bd38c">Ring</a>, OUT <a class="el" href="struct_d_e_s_c___i_n_d_i_c_e_s.html">DESC_INDICES</a> *Indices)</td></tr>
<tr class="separator:aa1456d91b0095ef7f57b57ca869b0ca1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a750a2896585045bf9d4008adc373781f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_virtio_lib_8h.html#a750a2896585045bf9d4008adc373781f">VirtioAppendDesc</a> (IN OUT <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *<a class="el" href="_virtio_device_8h.html#a2f00e71da7561b92d4924692680bd38c">Ring</a>, IN UINT64 BufferDeviceAddress, IN <a class="el" href="_xen_bus_8h.html#aa0673361ea749da32bbeeffdab834abb">UINT32</a> <a class="el" href="_virtio_device_8h.html#a6c4622c42086bd4633e8ee262358220b">BufferSize</a>, IN UINT16 Flags, IN OUT <a class="el" href="struct_d_e_s_c___i_n_d_i_c_e_s.html">DESC_INDICES</a> *Indices)</td></tr>
<tr class="separator:a750a2896585045bf9d4008adc373781f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa1ab07a0ff243507ebfb405d3fa7f42"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_virtio_device_8h.html#a74d7020e18780b17f5f8ca0573b29482">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_virtio_lib_8h.html#afa1ab07a0ff243507ebfb405d3fa7f42">VirtioFlush</a> (IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *VirtIo, IN UINT16 VirtQueueId, IN OUT <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *<a class="el" href="_virtio_device_8h.html#a2f00e71da7561b92d4924692680bd38c">Ring</a>, IN <a class="el" href="struct_d_e_s_c___i_n_d_i_c_e_s.html">DESC_INDICES</a> *Indices, OUT <a class="el" href="_xen_bus_8h.html#aa0673361ea749da32bbeeffdab834abb">UINT32</a> *UsedLen)</td></tr>
<tr class="separator:afa1ab07a0ff243507ebfb405d3fa7f42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fb6cd6829ff937952b340dd0bf8b2c4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_virtio_device_8h.html#a74d7020e18780b17f5f8ca0573b29482">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_virtio_lib_8h.html#a9fb6cd6829ff937952b340dd0bf8b2c4">Virtio10WriteFeatures</a> (IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *VirtIo, IN UINT64 <a class="el" href="_virtio_device_8h.html#a75886259cb3cff9e3884279807834c1d">Features</a>, IN OUT UINT8 *<a class="el" href="_virtio_device_8h.html#acf6cf224405aec9423207ca1d9c54b31">DeviceStatus</a>)</td></tr>
<tr class="separator:a9fb6cd6829ff937952b340dd0bf8b2c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cb7425f73b26a40310113c8971292cd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_virtio_device_8h.html#a74d7020e18780b17f5f8ca0573b29482">EFI_STATUS</a> EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_virtio_lib_8h.html#a4cb7425f73b26a40310113c8971292cd">VirtioMapAllBytesInSharedBuffer</a> (IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *VirtIo, IN <a class="el" href="_virtio_device_8h.html#aa4ac52e19518658dbdaaf279ab7ea8ef">VIRTIO_MAP_OPERATION</a> <a class="el" href="_virtio_device_8h.html#a55423277e6c247f85eb6d4721576fef1">Operation</a>, IN <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> *<a class="el" href="_virtio_device_8h.html#a7304d074ddc5990804d4b68e2434255e">HostAddress</a>, IN UINTN <a class="el" href="_virtio_device_8h.html#a03b101dd0e307d46720705ec087cb0c0">NumberOfBytes</a>, OUT EFI_PHYSICAL_ADDRESS *<a class="el" href="_virtio_device_8h.html#a4c40563baf4c5d7426229bf2f160b455">DeviceAddress</a>, OUT <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> **<a class="el" href="_virtio_device_8h.html#a286147d373e39bf0562dc60dbfbba621">Mapping</a>)</td></tr>
<tr class="separator:a4cb7425f73b26a40310113c8971292cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Declarations of utility functions used by virtio device drivers.</p>
<p>Copyright (C) 2012-2016, Red Hat, Inc. Copyright (C) 2017, AMD Inc, All rights reserved.<br/>
</p>
<p>SPDX-License-Identifier: BSD-2-Clause-Patent </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a9fb6cd6829ff937952b340dd0bf8b2c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_virtio_device_8h.html#a74d7020e18780b17f5f8ca0573b29482">EFI_STATUS</a> EFIAPI Virtio10WriteFeatures </td>
          <td>(</td>
          <td class="paramtype">IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *&#160;</td>
          <td class="paramname"><em>VirtIo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINT64&#160;</td>
          <td class="paramname"><em>Features</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN OUT UINT8 *&#160;</td>
          <td class="paramname"><em>DeviceStatus</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Report the feature bits to the VirtIo 1.0 device that the VirtIo 1.0 driver understands.</p>
<p>In VirtIo 1.0, a device can reject a self-inconsistent feature bitmap through the new VSTAT_FEATURES_OK status bit. (For example if the driver requests a higher level feature but clears a prerequisite feature.) This function is a small wrapper around <a class="el" href="struct___v_i_r_t_i_o___d_e_v_i_c_e___p_r_o_t_o_c_o_l.html#a38b76cd6850216aed11e1c5c15fb06b3">VIRTIO_DEVICE_PROTOCOL.SetGuestFeatures()</a> that also verifies if the VirtIo 1.0 device accepts the feature bitmap.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">VirtIo</td><td>Report feature bits to this device.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Features</td><td>The set of feature bits that the driver wishes to report. The caller is responsible to perform any masking before calling this function; the value is directly written with <a class="el" href="struct___v_i_r_t_i_o___d_e_v_i_c_e___p_r_o_t_o_c_o_l.html#a38b76cd6850216aed11e1c5c15fb06b3">VIRTIO_DEVICE_PROTOCOL.SetGuestFeatures()</a>.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">DeviceStatus</td><td>On input, the status byte most recently written to the device's status register. On output (even on error), DeviceStatus will be updated so that it is suitable for further status bit manipulation and writing to the device's status register.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The device accepted the configuration in Features.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>EFI_UNSUPPORTED The device rejected the configuration in Features.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>VirtIo-&gt;Revision is smaller than 1.0.0.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error codes from the SetGuestFeatures(), SetDeviceStatus(), GetDeviceStatus() member functions. </dd></dl>

</div>
</div>
<a class="anchor" id="a750a2896585045bf9d4008adc373781f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> EFIAPI VirtioAppendDesc </td>
          <td>(</td>
          <td class="paramtype">IN OUT <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *&#160;</td>
          <td class="paramname"><em>Ring</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINT64&#160;</td>
          <td class="paramname"><em>BufferDeviceAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN <a class="el" href="_xen_bus_8h.html#aa0673361ea749da32bbeeffdab834abb">UINT32</a>&#160;</td>
          <td class="paramname"><em>BufferSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINT16&#160;</td>
          <td class="paramname"><em>Flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN OUT <a class="el" href="struct_d_e_s_c___i_n_d_i_c_e_s.html">DESC_INDICES</a> *&#160;</td>
          <td class="paramname"><em>Indices</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Append a contiguous buffer for transmission / reception via the virtio ring.</p>
<p>This function implements the following section from virtio-0.9.5:</p>
<ul>
<li>2.4.1.1 Placing Buffers into the Descriptor Table</li>
</ul>
<p>Free space is taken as granted, since the individual drivers support only synchronous requests and host side status is processed in lock-step with request submission. It is the calling driver's responsibility to verify the ring size in advance.</p>
<p>The caller is responsible for initializing *Indices with <a class="el" href="_virtio_lib_8h.html#aa1456d91b0095ef7f57b57ca869b0ca1">VirtioPrepare()</a> first.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">Ring</td><td>The virtio ring to append the buffer to, as a descriptor.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BufferDeviceAddress</td><td>(Bus master device) start address of the transmit / receive buffer.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BufferSize</td><td>Number of bytes to transmit or receive.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Flags</td><td>A bitmask of VRING_DESC_F_* flags. The caller computes this mask dependent on further buffers to append and transfer direction. VRING_DESC_F_INDIRECT is unsupported. The <a class="el" href="struct_v_r_i_n_g___d_e_s_c.html#a08781720afbd72718b6e5c693dafd780">VRING_DESC.Next</a> field is always set, but the host only interprets it dependent on VRING_DESC_F_NEXT.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">Indices</td><td>Indices-&gt;HeadDescIdx is not accessed. On input, Indices-&gt;NextDescIdx identifies the next descriptor to carry the buffer. On output, Indices-&gt;NextDescIdx is incremented by one, modulo 2^16. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="afa1ab07a0ff243507ebfb405d3fa7f42"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_virtio_device_8h.html#a74d7020e18780b17f5f8ca0573b29482">EFI_STATUS</a> EFIAPI VirtioFlush </td>
          <td>(</td>
          <td class="paramtype">IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *&#160;</td>
          <td class="paramname"><em>VirtIo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINT16&#160;</td>
          <td class="paramname"><em>VirtQueueId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN OUT <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *&#160;</td>
          <td class="paramname"><em>Ring</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN <a class="el" href="struct_d_e_s_c___i_n_d_i_c_e_s.html">DESC_INDICES</a> *&#160;</td>
          <td class="paramname"><em>Indices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT <a class="el" href="_xen_bus_8h.html#aa0673361ea749da32bbeeffdab834abb">UINT32</a> *&#160;</td>
          <td class="paramname"><em>UsedLen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Notify the host about the descriptor chain just built, and wait until the host processes it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">VirtIo</td><td>The target virtio device to notify.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">VirtQueueId</td><td>Identifies the queue for the target device.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">Ring</td><td>The virtio ring with descriptors to submit.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Indices</td><td>Indices-&gt;NextDescIdx is not accessed. Indices-&gt;HeadDescIdx identifies the head descriptor of the descriptor chain.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">UsedLen</td><td>On success, the total number of bytes, consecutively across the buffers linked by the descriptor chain, that the host wrote. May be NULL if the caller doesn't care, or can compute the same information from device-specific request structures linked by the descriptor chain.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code from VirtIo-&gt;SetQueueNotify() if it fails.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>Otherwise, the host processed all descriptors. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a4cb7425f73b26a40310113c8971292cd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_virtio_device_8h.html#a74d7020e18780b17f5f8ca0573b29482">EFI_STATUS</a> EFIAPI VirtioMapAllBytesInSharedBuffer </td>
          <td>(</td>
          <td class="paramtype">IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *&#160;</td>
          <td class="paramname"><em>VirtIo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN <a class="el" href="_virtio_device_8h.html#aa4ac52e19518658dbdaaf279ab7ea8ef">VIRTIO_MAP_OPERATION</a>&#160;</td>
          <td class="paramname"><em>Operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> *&#160;</td>
          <td class="paramname"><em>HostAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINTN&#160;</td>
          <td class="paramname"><em>NumberOfBytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT EFI_PHYSICAL_ADDRESS *&#160;</td>
          <td class="paramname"><em>DeviceAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> **&#160;</td>
          <td class="paramname"><em>Mapping</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Provides the virtio device address required to access system memory from a DMA bus master.</p>
<p>The interface follows the same usage pattern as defined in UEFI spec 2.6 (Section 13.2 PCI Root Bridge I/O Protocol)</p>
<p>The <a class="el" href="_virtio_lib_8h.html#a4cb7425f73b26a40310113c8971292cd">VirtioMapAllBytesInSharedBuffer()</a> is similar to VIRTIO_MAP_SHARED with exception that NumberOfBytes is IN-only parameter. The function maps all the bytes specified in NumberOfBytes param in one consecutive range.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">VirtIo</td><td>The virtio device for which the mapping is requested.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Operation</td><td>Indicates if the bus master is going to read or write to system memory.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HostAddress</td><td>The system memory address to map to shared buffer address.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">NumberOfBytes</td><td>Number of bytes to map.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">DeviceAddress</td><td>The resulting shared map address for the bus master to access the hosts HostAddress.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Mapping</td><td>A resulting token to pass to VIRTIO_UNMAP_SHARED.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The NumberOfBytes is successfully mapped. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>The HostAddress cannot be mapped as a common buffer. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>One or more parameters are invalid. </td></tr>
    <tr><td class="paramname">EFI_OUT_OF_RESOURCES</td><td>The request could not be completed due to a lack of resources. This includes the case when NumberOfBytes bytes cannot be mapped in one consecutive range. </td></tr>
    <tr><td class="paramname">EFI_DEVICE_ERROR</td><td>The system hardware could not map the requested address. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aa1456d91b0095ef7f57b57ca869b0ca1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> EFIAPI VirtioPrepare </td>
          <td>(</td>
          <td class="paramtype">IN OUT <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *&#160;</td>
          <td class="paramname"><em>Ring</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT <a class="el" href="struct_d_e_s_c___i_n_d_i_c_e_s.html">DESC_INDICES</a> *&#160;</td>
          <td class="paramname"><em>Indices</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Turn off interrupt notifications from the host, and prepare for appending multiple descriptors to the virtio ring.</p>
<p>The calling driver must be in VSTAT_DRIVER_OK state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">Ring</td><td>The virtio ring we intend to append descriptors to.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Indices</td><td>The <a class="el" href="struct_d_e_s_c___i_n_d_i_c_e_s.html">DESC_INDICES</a> structure to initialize. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aa2085097636d56c69b494e6e888fe296"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_virtio_device_8h.html#a74d7020e18780b17f5f8ca0573b29482">EFI_STATUS</a> EFIAPI VirtioRingInit </td>
          <td>(</td>
          <td class="paramtype">IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *&#160;</td>
          <td class="paramname"><em>VirtIo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINT16&#160;</td>
          <td class="paramname"><em>QueueSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *&#160;</td>
          <td class="paramname"><em>Ring</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Configure a virtio ring.</p>
<p>This function sets up internal storage (the guest-host communication area) and lays out several "navigation" (ie. no-ownership) pointers to parts of that storage.</p>
<p>Relevant sections from the virtio-0.9.5 spec:</p>
<ul>
<li>1.1 Virtqueues,</li>
<li>2.3 Virtqueue Configuration.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">VirtIo</td><td>The virtio device which will use the ring.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">The</td><td>number of descriptors to allocate for the virtio ring, as requested by the host.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Ring</td><td>The virtio ring to set up.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Status codes propagated from VirtIo-&gt;AllocateSharedPages().</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>Allocation and setup successful. Ring-&gt;Base (and nothing else) is responsible for deallocation. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a9d4116c6aaf08c320bee0b3cfb1b63ed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_virtio_device_8h.html#a74d7020e18780b17f5f8ca0573b29482">EFI_STATUS</a> EFIAPI VirtioRingMap </td>
          <td>(</td>
          <td class="paramtype">IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *&#160;</td>
          <td class="paramname"><em>VirtIo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *&#160;</td>
          <td class="paramname"><em>Ring</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT UINT64 *&#160;</td>
          <td class="paramname"><em>RingBaseShift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT <a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> **&#160;</td>
          <td class="paramname"><em>Mapping</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Map the ring buffer so that it can be accessed equally by both guest and hypervisor.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">VirtIo</td><td>The virtio device instance.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Ring</td><td>The virtio ring to map.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">RingBaseShift</td><td>A resulting translation offset, to be passed to VirtIo-&gt;SetQueueAddress().</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Mapping</td><td>A resulting token to pass to VirtIo-&gt;UnmapSharedBuffer().</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Status code from VirtIo-&gt;MapSharedBuffer() </dd></dl>

</div>
</div>
<a class="anchor" id="ae4a083ec4bee2616db38ffcb04251d14"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_xen_bus_8h.html#a232bfc9995687270dc37edef69b3ac4f">VOID</a> EFIAPI VirtioRingUninit </td>
          <td>(</td>
          <td class="paramtype">IN <a class="el" href="_virtio_device_8h.html#ab6aacc5a49a155b55afafd5bec754c84">VIRTIO_DEVICE_PROTOCOL</a> *&#160;</td>
          <td class="paramname"><em>VirtIo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN OUT <a class="el" href="struct_v_r_i_n_g.html">VRING</a> *&#160;</td>
          <td class="paramname"><em>Ring</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Tear down the internal resources of a configured virtio ring.</p>
<p>The caller is responsible to stop the host from using this ring before invoking this function: the VSTAT_DRIVER_OK bit must be clear in VhdrDeviceStatus.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">VirtIo</td><td>The virtio device which was using the ring.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Ring</td><td>The virtio ring to clean up. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_782809600008140d37245a8991744230.html">OvmfPkg</a></li><li class="navelem"><a class="el" href="dir_65f9f3e48d1acd3a56b2b8a29723b724.html">Include</a></li><li class="navelem"><a class="el" href="dir_92a52f437583bf372b183e16e2da6eca.html">Library</a></li><li class="navelem"><a class="el" href="_virtio_lib_8h.html">VirtioLib.h</a></li>
    <li class="footer">Generated on Sun Dec 5 2021 00:12:57 for OvmfPkg[all] by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
